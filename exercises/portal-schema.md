# Portal Exercise Schema

Use a small TOML manifest per exercise so the workshop site can load, run, and validate tasks uniformly.

## Manifest Fields

```toml
title = "Parse and Print"
track = "foundations"
level = "beginner"
estimated_minutes = 10
kind = "transform_ir" # transform_ir | build_ir | debug_failure | inspect_only
tags = ["context", "parsing", "verification"]

prompt = """
Parse the input IR and return a normalized IR string.
"""

input_ir = "input.ll"
starter_code = "starter.py"
reference_solution = "solution.py" # optional, hidden in production
hints = ["Use `with llvm.create_context() as ctx`.", "Call `mod.verify()` before returning."]
pitfalls = [
  "Parser success does not guarantee verifier success.",
  "Invalid lifetime usage should raise LLVMMemoryError.",
]

# Convention-first mode can infer:
# - id from filename stem: 01_F01.toml -> F01
# - sidecars: <stem>.starter.py, <stem>.solution.py
# - optional input sidecar: <stem>.input.ll
# - custom validator: <stem>.validator.py

[entrypoint]
function = "solve"
returns = "ir_text" # ir_text | json_report | exception

[validation]
mode = "combined" # text | properties | exceptions | combined

[[validation.checks]]
type = "verify_module"

[[validation.checks]]
type = "ir_equal_normalized"
expected_file = "expected.ll"

[[validation.checks]]
type = "assert_no_forbidden_api"
forbidden = ["subprocess", "ctypes"]
```

## Check Types

Recommended check primitives:

- `verify_module`
- `ir_equal_exact`
- `ir_equal_normalized`
- `function_signature_equals`
- `cfg_shape_equals`
- `phi_incoming_matches_predecessors`
- `raises_exception_type`
- `metadata_present`
- `symbol_table_contains`
- `instruction_sequence_contains`

## Normalization Policy

For text-based comparisons:

- strip comments that are not semantically relevant
- normalize whitespace
- optionally normalize autogenerated symbol names
- keep ordering-sensitive regions unchanged

## Security and Sandbox

For portal execution:

- run user code in a sandboxed process
- cap CPU time and memory
- block filesystem/network unless explicitly needed
- record stdout/stderr for feedback
